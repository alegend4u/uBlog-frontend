<template>
  <div class="page">
    <div class="page_header">
      <svg
        class="datebox"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 459.661 77"
      >
        <g
          id="Date_Box"
          data-name="Date Box"
          transform="translate(0 -109.278)"
          fill="#fff"
        >
          <path
            d="M 382.8167419433594 185.7777709960938 L 76.84408569335938 185.7777709960938 C 66.53749847412109 185.7777709960938 56.53944396972656 183.7592926025391 47.12767791748047 179.7784729003906 C 42.60408782958984 177.8651733398438 38.24103164672852 175.4970092773438 34.15973663330078 172.7397155761719 C 30.11708831787109 170.0085296630859 26.31550025939941 166.8719482421875 22.86067771911621 163.4171142578125 C 19.40585327148438 159.9622955322266 16.26926612854004 156.1607055664062 13.53808879852295 152.1180572509766 C 10.78079509735107 148.0367736816406 8.412618637084961 143.6737060546875 6.499324321746826 139.1501159667969 C 2.582888126373291 129.8905792236328 0.5658418536186218 120.0633239746094 0.5016176104545593 109.9333267211914 C 11.89460754394531 109.9247131347656 208.9629516601562 109.7777709960938 340.3304443359375 109.7777709960938 C 414.60009765625 109.7777709960938 454.5297546386719 109.8234634399414 459.1593322753906 109.91357421875 C 459.0977478027344 120.0509033203125 457.0805969238281 129.8842620849609 453.1614990234375 139.1501159667969 C 451.2481994628906 143.6737060546875 448.8799743652344 148.0367736816406 446.1227416992188 152.1180572509766 C 443.3915710449219 156.1607055664062 440.2549743652344 159.9622955322266 436.8001403808594 163.4171142578125 C 433.3452758789062 166.8719482421875 429.5437316894531 170.0085296630859 425.5010986328125 172.7397155761719 C 421.4197387695312 175.4970092773438 417.0567321777344 177.8651733398438 412.5331420898438 179.7784729003906 C 403.1213684082031 183.7592926025391 393.1233215332031 185.7777709960938 382.8167419433594 185.7777709960938 Z"
            stroke="none"
          />
          <path
            d="M 340.3303833007812 110.2777709960938 C 210.57373046875 110.2777709960938 16.71951293945312 110.4211273193359 1.00634765625 110.4329528808594 C 1.13250732421875 120.3195953369141 3.1337890625 129.9096984863281 6.959747314453125 138.9553527832031 C 8.860504150390625 143.4491729736328 11.213134765625 147.7835845947266 13.95233154296875 151.8381805419922 C 16.66567993164062 155.8544769287109 19.7818603515625 159.6312408447266 23.21414184570312 163.0635986328125 C 26.64651489257812 166.4958801269531 30.42327880859375 169.612060546875 34.43954467773438 172.3254089355469 C 38.494140625 175.0645904541016 42.82855224609375 177.417236328125 47.3223876953125 179.3179931640625 C 56.67221069335938 183.2725830078125 66.60467529296875 185.2777709960938 76.84402465820312 185.2777709960938 L 382.8166809082031 185.2777709960938 C 393.0560302734375 185.2777709960938 402.9884948730469 183.2725830078125 412.3383178710938 179.3179931640625 C 416.8321533203125 177.417236328125 421.1665649414062 175.0645904541016 425.2211608886719 172.3254089355469 C 429.2374267578125 169.612060546875 433.0142211914062 166.4958801269531 436.4465637207031 163.0635986328125 C 439.8788452148438 159.6312408447266 442.9950256347656 155.8544769287109 445.7083740234375 151.8381805419922 C 448.4475708007812 147.7835845947266 450.8002014160156 143.4491729736328 452.7009582519531 138.9553527832031 C 456.5303039550781 129.9017028808594 458.53173828125 120.3020324707031 458.6546936035156 110.4061279296875 C 453.7621154785156 110.3435516357422 427.8030395507812 110.2777709960938 340.3303833007812 110.2777709960938 M 340.3303833007812 109.2777557373047 C 408.4407348632812 109.2777557373047 459.5414428710938 109.3167419433594 459.6607360839844 109.4337158203125 C 459.6607360839844 151.87353515625 425.2565002441406 186.2777709960938 382.8166809082031 186.2777709960938 L 76.84402465820312 186.2777709960938 C 34.40420532226562 186.2777709960938 -3.0517578125e-05 151.87353515625 -3.0517578125e-05 109.4337158203125 C -3.0517578125e-05 109.4337158203125 204.1346282958984 109.2777557373047 340.3303833007812 109.2777557373047 Z"
            stroke="none"
            fill="#707070"
          />
        </g>
        <text
          class="date"
          x="50%"
          y="50%"
          dominant-baseline="middle"
          text-anchor="middle"
        >
          {{ getFormattedDate(page?.date) }}
        </text>
      </svg>

      <p class="post_title">{{ page?.title }}</p>
    </div>
    <p class="intro">{{ page?.intro }}</p>

    <div class="post_body" v-html="page?.body"></div>
  </div>
  <router-link to="/blog">
    <svg
      class="back"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 87.76 87.76"
    >
      <g id="layer-back" data-name="back">
        <path
          class="cls-1"
          d="M43.88,0h0A43.89,43.89,0,0,0,0,43.88H0A43.89,43.89,0,0,0,43.88,87.76h0A43.89,43.89,0,0,0,87.76,43.88h0A43.89,43.89,0,0,0,43.88,0ZM69.49,45.83a2.57,2.57,0,0,1-2.57,2.57H30.68l16,15.94a2.58,2.58,0,0,1,0,3.64l-1.19,1.19a2.58,2.58,0,0,1-3.64,0L20.94,48.3l0,0h0l-1.51-1.52-.15-.16a2.57,2.57,0,0,1-.6-1.41,3.09,3.09,0,0,1,0-.43,2.56,2.56,0,0,1,.63-1.45l.12-.12,1.43-1.43.12-.12L41.8,20.76a2.58,2.58,0,0,1,3.64,0L46.63,22a2.57,2.57,0,0,1,0,3.63l-16,16h36.3a2.57,2.57,0,0,1,2.57,2.57Z"
        />
      </g>
    </svg>
  </router-link>
  <a class="nav_post prev" href="#">
    <span class="tooltip_text">Prev blog</span>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 62 70">
      <g id="prev" transform="translate(0 70) rotate(-90)">
        <path
          d="M 65.71787261962891 59.5 L 4.282129764556885 59.5 L 35 5.085487365722656 L 65.71787261962891 59.5 Z"
          stroke="none"
        />
        <path
          class="border"
          d="M 35 10.17098617553711 L 8.564266204833984 57 L 61.43573379516602 57 L 35 10.17098617553711 M 35 0 L 70 62 L 0 62 L 35 0 Z"
          stroke="none"
          fill="#707070"
        />
      </g>
    </svg>
  </a>
  <a class="nav_post next" href="#">
    <span class="tooltip_text">Next blog</span>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 62 70">
      <g id="prev" transform="translate(0 70) rotate(-90)">
        <path
          d="M 65.71787261962891 59.5 L 4.282129764556885 59.5 L 35 5.085487365722656 L 65.71787261962891 59.5 Z"
          stroke="none"
        />
        <path
          class="border"
          d="M 35 10.17098617553711 L 8.564266204833984 57 L 61.43573379516602 57 L 35 10.17098617553711 M 35 0 L 70 62 L 0 62 L 35 0 Z"
          stroke="none"
        />
      </g>
    </svg>
  </a>
</template>
<script>
import BlogService from "../services/BlogService";
import { getFormattedDate } from "../services/Utils";

export default {
  name: "Post",
  props: ["slug"],
  data() {
    return {
      page: null,
    };
  },

  created() {
    BlogService.getPost(this.slug)
      .then((response) => {
        this.page = response.data.items[0];
      })
      .catch((error) => {
        console.log(error);
      });
  },

  mounted() {
    this.page_header = document.querySelector(".page_header");
    this.post_title = document.querySelector(".post_title");
    this.max_title_size = unpx(
      window
        .getComputedStyle(this.post_title, null)
        .getPropertyValue("font-size")
    );
    this.min_title_size = Math.floor(0.6 * this.max_title_size);

    this.datebox = document.querySelector(".datebox");
    this.max_datebox_width = unpx(
      window.getComputedStyle(this.datebox, null).getPropertyValue("width")
    );
    this.min_datebox_width = Math.floor(0.75 * this.max_datebox_width);

    this.scroll_span = 300;

    function unpx(px_value) {
      return parseInt(px_value.slice(0, -2));
    }

    window.onscroll = this.animate_header;
  },

  methods: {
    getFormattedDate,
    animate_header() {
      let scroll = document.documentElement.scrollTop;
      var scale_down = 0;
      if (scroll >= this.scroll_span) {
        scale_down = 1;
      } else {
        scale_down = scroll / this.scroll_span;
        if (scroll > 0) {
          this.page_header.classList.add("scrolled");
        } else {
          this.page_header.classList.remove("scrolled");
        }
      }

      let calculated_font_size = Math.round(
        this.max_title_size -
          (this.max_title_size - this.min_title_size) * scale_down
      );
      this.post_title.style.fontSize = calculated_font_size + "px";

      let calculated_datebox_width = Math.round(
        this.max_datebox_width -
          (this.max_datebox_width - this.min_datebox_width) * scale_down
      );
      this.datebox.style.width = calculated_datebox_width + "px";
    },
  },
};
</script>

<style lang="scss" scoped>
@import "@/sass/blog/post.sass";
</style>
